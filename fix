#!/bin/bash

mkdir fixed

for i in *.mp4
do
	# Create a filename that contains the date and time
	filename=$(basename "$i")
	filename="${filename%.*}"
	newname=$(stat -t %Y-%m-%d-%H-%M-%S -f %Sm -- $i)

	duration=`ffprobe -i $i -show_entries format=duration -v quiet -of csv="p=0" -sexagesimal`
	ffmpeg -err_detect ignore_err -i $i -c copy fixed/temp.mp4

	# does not work. must reencode.
	#ffmpeg -i fixed/temp.mp4 -vcodec copy -acodec copy -t $duration "fixed/$newname-$i"

	# reencode to fix duration.
	ffmpeg -i fixed/temp.mp4 -ss 00:00:00 -t $duration -async 1 "fixed/$newname-$i"
	rm fixed/temp.mp4
done
